<!doctype>
<html ng-app='sleth'>
<head>
    <title>sleth - Ethereum Slots</title>
    <script type="text/javascript" src="lib/angular.min.js"></script>
    <script type="text/javascript" src="lib/angular-animate.min.js"></script>
    <script type="text/javascript" src="lib/promise.min.js"></script>
    <script type="text/javascript" src="lib/bignumber.min.js"></script>
    <script type="text/javascript" src="lib/ethereum.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/flatly/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/slots.css" />
</head>
<body ng-controller="SlethController" ng-keypress="handleKey($event)">

<div class="container">

<div class="row player-bar">
    <div class="col-sm-3">
        Player <span class="label label-default">{{player.address | limitTo : 10}}</span>
    </div>
    <div class="col-sm-3 text-center">
        Balance <span class="label label-default value-change" ng-class="['value-'+player.balance]">{{player.balance | number : 4}} ETH</span>
    </div>
    <div class="col-sm-3 text-center">
        Block <span class="label label-default value-change" ng-class="['value-'+web3.blockNumber]">{{web3.blockNumber}}</span>
    </div>
    <div class="col-sm-3 text-right">
        Network
        <span ng-switch on="web3.available">
            <span ng-switch-when="true" class="label label-success">online</span>
            <span ng-switch-when="false" class="label label-danger">offline</span>
        </span>
    </div>
</div>

<div class="alert alert-danger top-buffer" role="alert" ng-if="web3.error">
    <strong>{{web3.error.name}}</strong> {{web3.error.message}}
</div>

<div class="row">
    <div class="col-md-8 text-center">
        <div id="game" ng-style="{'width': canvasSize}">
            <canvas slots-reels id="slots" width="{{canvasSize}}" height="{{canvasSize}}"></canvas>
        </div>
    </div>
    <div class="col-md-4">
        <h1 id="credits">
            <ng-pluralize count="player.coins"
             when="{'0': 'No Coins',
                    'one': '1 Coin',
                    'other': '{} Coins'}">
            </ng-pluralize>
        </h1>

        <div class="jumbotron" ng-if="state == 0">
            <h3>Place your bet!</h3>
        </div>

        <div class="list-group" ng-if="state == 1">
            <li class="list-group-item" ng-repeat="(line, partial_payout) in reward.partial_payouts">
                Line {{line}} pays {{partial_payout}}
            </li>
            <li class="list-group-item list-group-item-success" ng-if="reward.payout">
                You won {{reward.payout}}!
                <span class="badge" ng-if="reward.verified">verified</span>
            </li>
            <li class="list-group-item list-group-item" ng-if="!reward.payout">
                You won nothing :(
                <span class="badge" ng-if="reward.verified">verified</span>
            </li>
        </div>

        <div class="list-group" ng-if="state == 2">
            <li class="list-group-item list-group-item">
                <p class="lead">Spinning...</p>
                <div class="progress">
                    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%">
                        <span class="sr-only">spinning...</span>
                    </div>
                </div>
            </li>
        </div>

        <div class="list-group" ng-if="state == 3">
            <li class="list-group-item list-group-item">
                <p class="lead">Spinning...</p>
                <div class="progress">
                    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100" style="width: 66%">
                        <span class="sr-only">spinning...</span>
                    </div>
                </div>
            </li>
        </div>

        <div class="list-group" ng-if="state == 4">
            <li class="list-group-item list-group-item">
                <p class="lead">Claiming results...</p>
                <div class="progress">
                    <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width: 90%">
                        <span class="sr-only">claiming results...</span>
                    </div>
                </div>
            </li>
        </div>

    </div>
</div>

<div class="row">
    <div class="col-md-8 text-center">
        <button type="button" class="btn btn-info" ng-click="spin(1)" ng-disabled="player.coins < 1 || state > 1">1 Line</button>
        <button type="button" class="btn btn-info" ng-click="spin(3)" ng-disabled="player.coins < 3 || state > 1">3 Lines</button>
        <button type="button" class="btn btn-info" ng-click="spin(5)" ng-disabled="player.coins < 5 || state > 1">5 Lines</button>
    </div>
    <div class="col-md-4">
        <p>
            <a class="btn btn-default" href="paytable.html" target="_blank" role="button">
                <span class="glyphicon glyphicon-question-sign"></span> Pay Table
            </a>
        </p>
    </div>
</div>

<div class="row top-buffer">
    <div class="col-md-8">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Last Round #{{round.number}}</h3>
            </div>
            <table class="table table-condensed">
                <tr><th>Player</th><td>{{round.player | limitTo : 10}}</td></tr>
                <tr><th>Block</th><td>{{round.block}}</td></tr>
                <tr><th>Time</th><td>{{round.timestamp | date : 'medium'}}</td></tr>
                <tr><th>Bet</th><td>{{round.bet}}</td></tr>
                <tr ng-if="round.status == 2 && state < 2"><th>Result</th><td>{{round.result}}</td></tr>
                <tr ng-if="round.status == 2 && state < 2"><th>Entropy</th><td>{{round.entropy | limitTo : 10}}</td></tr>
                <tr ng-if="round.status == 2 && state < 2"><th>RND</th><td>{{round.rnd}}</td></tr>
                <tr><th>Status:
                    <td ng-switch on="round.status">
                        <span ng-switch-when="0">NEW</span>
                        <span ng-switch-when="1">SPINNING</span>
                        <span ng-switch-when="2">DONE</span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="col-md-4">
        <div class="panel panel-warning">
            <div class="panel-heading">
                <h3 class="panel-title">Stats</h3>
            </div>
            <table class="table table-condensed">
                <tr><th>Contract</th><td>{{slethAddress | limitTo : 10}}</td></tr>
                <tr><th>Contract Balance</th><td>{{stats.slethBalance | number : 4}} ETH</td></tr>
                <tr><th>Total Spins</th><td>{{stats.total_spins}}</td></tr>
                <tr><th>Total Coins Won</th><td>{{stats.total_coins_won}}</td></tr>
            </table>
        </div>
    </div>
</div>

</div>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="game.js"></script>
<script type="text/javascript" src="reels.js"></script>
<script type="text/javascript" src="sleth.js"></script>
</body>
</html>
